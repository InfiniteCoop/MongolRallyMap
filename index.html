
<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'/>
<!--[if lt IE 9]>
<script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<script src='underscore-min.js'></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />
<style>
body {
  margin:0px;
  padding:0px;
  font:normal 15px/20px Arial,sans-serif;
  background:#fff;
  }

article {
  width:33.3333%;
  min-width:320px;
  position:relative;
  padding-top:40px;
  padding-bottom:33.3333%;
  }
section {
  padding:40px;
  margin-left:40px;
  position:relative;
  transition:background 500ms, color 500ms;
  -moz-transition:background 500ms, color 500ms;
  -webkit-transition:background 500ms, color 500ms;
  }
section,
section a {
  color:#888;
  color:rgba(128,128,128,0);
  text-decoration:none;
  text-shadow:rgba(64,64,64,1) 0px 0px 4px;
  }
section.active {
  background:#0097fb;
  color:#eee;
  }
section.active a { color:#eee; }
section.active small { color:#aaa; }
h1 { font-size:2em; line-height:1em; }
h2 { font-size:1.3333em; }
h1,h2 { margin:0px 0px 10px; }
p { font-size:.85em; margin:0px; }

.scroll {
  position:absolute;
  right:0px; bottom:0px;
  font-size:12px;
  text-transform:uppercase;
  padding:5px 120px;
  text-align:center;
  }
.colophon {
  display:block;
  margin-top:10px;
  }

.cover:before {
  content:'';
  display:block;
  width:120px; height:120px;
  margin:0px auto 20px;
  }
.cover.active:before { background:url(icons.png) 0px -120px no-repeat; }

#pane {
  position:fixed;
  top:0px;
  bottom:0px;
  right:0px;
  width:66.6666%;
  }
#map  {
  position:absolute;
  top:0px;
  bottom:0px;
  width:200%;
  left:-50%;
  transition:opacity 250ms;
  -moz-transition:opacity 250ms;
  -webkit-transition:opacity 250ms;
  }

.spot {
  width:120px;
  height:120px;
  margin:-60px 0px 0px -60px;
  background:url(icons.png) 120px 120px no-repeat;
  position:absolute;
  }

.spot.active {
  width:120px;
  height:120px;
  margin:-60px 0px 0px -60px;
  background:url(icons.png) 120px 120px no-repeat;
  position:absolute;
  }

.spot-cover { display:none; }
.spot-hyde { background-position:-130px 0px; }
.spot-hyde.active { background-position:-130px -120px; }
.spot-dover { background-position:-130px 0px; }
.spot-dover.active { background-position:-130px -120px; }
.spot-calais { background-position:-130px 0px; }
.spot-calais.active { background-position:-130px -120px; }
.spot-ghent { background-position:-130px 0px; }
.spot-ghent.active { background-position:-130px -120px; }
.spot-nuremberg { background-position:-130px 0px; }
.spot-nuremberg.active { background-position:-130px -120px; }
.spot-klenova { background-position:-130px 0px; }
.spot-klenova.active { background-position:-130px -120px; }
.spot-prague { background-position:-130px 0px; }
.spot-prague.active { background-position:-130px -120px; }
.spot-vienna { background-position:-130px 0px; }
.spot-vienna.active { background-position:-130px -120px; }
.spot-zagreb { background-position:-130px 0px; }
.spot-zagreb.active { background-position:-130px -120px; }
.spot-split { background-position:-130px 0px; }
.spot-split.active { background-position:-130px -120px; }
.spot-dubrovnik { background-position:-130px 0px; }
.spot-dubrovnik.active { background-position:-130px -120px; }
.spot-sofia { background-position:-130px 0px; }
.spot-sofia.active { background-position:-130px -120px; }
.spot-istanbul { background-position:-130px 0px; }
.spot-istanbul.active { background-position:-130px -120px; }
.spot-ankara { background-position:-130px 0px; }
.spot-ankara.active { background-position:-130px -120px; }
.spot-goreme { background-position:-130px 0px; }
.spot-goreme.active { background-position:-130px -120px; }
.spot-batumi { background-position:-130px 0px; }
.spot-batumi.active { background-position:-130px -120px; }
.spot-tbilisi { background-position:-130px 0px; }
.spot-tbilisi.active { background-position:-130px -120px; }
.spot-baku { background-position:-130px 0px; }
.spot-baku.active { background-position:-130px -120px; }
.spot-turkmenbashi { background-position:-130px 0px; }
.spot-turkmenbashi.active { background-position:-130px -120px; }
.spot-ashgabat { background-position:-130px 0px; }
.spot-ashgabat.active { background-position:-130px -120px; }
.spot-khiva { background-position:-130px 0px; }
.spot-khiva.active { background-position:-130px -120px; }
.spot-bukhara { background-position:-130px 0px; }
.spot-bukhara.active { background-position:-130px -120px; }
.spot-samarkand { background-position:-130px 0px; }
.spot-samarkand.active { background-position:-130px -120px; }
.spot-dushanbe { background-position:-130px 0px; }
.spot-dushanbe.active { background-position:-130px -120px; }
.spot-khorog { background-position:-130px 0px; }
.spot-khorog.active { background-position:-130px -120px; }
.spot-osh { background-position:-130px 0px; }
.spot-osh.active { background-position:-130px -120px; }
.spot-bishkek { background-position:-130px 0px; }
.spot-bishkek.active { background-position:-130px -120px; }
.spot-almaty { background-position:-130px 0px; }
.spot-almaty.active { background-position:-130px -120px; }
.spot-semey { background-position:-130px 0px; }
.spot-semey.active { background-position:-130px -120px; }
.spot-novosibirsk { background-position:-130px 0px; }
.spot-novosibirsk.active { background-position:-130px -120px; }
.spot-khovd { background-position:-130px 0px; }
.spot-khovd.active { background-position:-130px -120px; }
.spot-bayankhongor { background-position:-130px 0px; }
.spot-bayankhongor.active { background-position:-130px -120px; }
.spot-ulaanbaatar { background-position:-130px 0px; }
.spot-ulaanbaatar.active { background-position:-130px -120px; }


/* Distinguish the "cover page" visually other sections. */
body.section-0 #map { opacity:0.75; }

@media (max-width:640px) {
  body {
    font-size:12px;
    line-height:16px;
    }
  article {
    width:100%;
    min-width:100%;
    padding-top:0px;
    padding-bottom:200%;
    }
  section {
    text-shadow:none;
    margin-left:0px;
    padding:30px;
    }
  section.active {
    position:fixed;
    top:0px; left:0px; right:0px;
    }
  #pane { width:100%; }
  #map  {
    bottom:0%;
    left:0%;
    width:100%;
    height:150%;
    }
  }

@media (min-width:1280px) {
  body {
    font-size:18px;
    line-height:24px;
    }
  }
</style>
</head>
<body class='section-0'>

<div id='pane'><div id='map'></div></div>

<article>
  <section id='cover' class='cover active'>
    <h2>Crossing the Rubikhan: England to Mongolia</h2>
    <p>Next summer, four friends – Cooper, Keshav, Nick, and Benjie – will drive 10,000 miles from England to Mongolia to fundraise for, and raise awareness of, two important charities: the Cool Earth Foundation, which is dedicated to rainforest preservation, and SOS Children's Villages, which provides foster care for orphaned or abandoned children in destitute communities.</p>
    <p>This map traces team Crossing the Rubikhan's route from start to finish, identifying many of the notable sites and cities that they'll visit along the way. Follow along, and join in the adventure!</p>
    <small class='scroll'>Scroll ▼ to begin!</small>
  </section>

  <section id='hyde'>
   <h2>Hyde Park</h2>
&nbsp;
<p> Hyde Park is one of the largest parks in London and the starting point of the 2014 Mongol Rally! 200 cars carrying 500 insane people will caravan out of the city of London and into the biggest adventure of their lives. </p>
&nbsp;
<p> <strong> Projected Progress </strong> This is it. Where it all begins. Our car will be in tip-top shape, we’ll all be friends, and a potent combination of adrenaline and sheer dread will be coursing through our veins. </p>
&nbsp;
<p> <strong> Fun Fact </strong> They drive on the left side of the road in the UK. So we’re screwed. </p>
 </section>

  <section id='dover'>
   <h2>Dover</h2>
&nbsp;
<p> Dover is a coastal town in Southeast England and a major ferry port for crossing the English Channel (and sometimes the Rubikhan). </p>
&nbsp;
<p> <strong> Projected Progress </strong> Finally—we reach the end of driving on the wrong side of the road. Cheapskates that we are, we will take the boring car ferry instead of the supercool Chunnel, which I believe is a portmanteau of the words “cheese” and “funnel.” </p>
&nbsp;
<p> <strong> Fun Fact </strong> “Cliffs of Dover” may be an impressive nearby landform, but it is better known as the song that Nick could never beat on Expert in Guitar Hero. </p>
 </section>

 <section id='calais'>
   <h2>Calais</h2>
   &nbsp;
<p> Calais is our gateway to France. It is another major port town on the other side of the Channel. The daily mean temperature in July is 63F. So a little cooler than DC but a little warmer than Hanover. Awesome! </p>
&nbsp;
<p> <strong> Projected Progress </strong> Hello mainland Europe and what should be the easiest part of the Rally! We’re going to forgo the sights (how Calais of us) and cruise onwards towards Germany and Prague as quickly as possible. </p>
&nbsp;
<p> <strong> Fun Fact </strong> Calais is actually an artificial island, which is good because we are artificial people with artificial hopes and dreams. </p>
 </section>

 <section id='ghent'>
   <h2>Ghent</h2>
   &nbsp;
<p> This city is beautiful. It’s the Belgian version of Amsterdam with picturesque Dutch style row houses and interlocking canals. </p>
&nbsp;
<p> <strong> Projected Progress </strong> I’m sure it will look great from the window of our car as we cruise through in hopes of making the next day’s Launch Party. </p>
&nbsp;
<p> <strong> Fun Fact </strong> People from Ghent are called “Rope Bearers” because they rebelled against some King who punished them by making them wear ropes. How humiliating! </p>
 </section>

 <section id='nuremberg'>
   <h2>Nuremberg</h2>
&nbsp;
<p> Located in central Germany, Nuremberg is a classic European city with castles, a walled city center, and beer that is probably a little too expensive. </p>
&nbsp;
<p> <strong> Projected Progress </strong> Boring! By now we’ll be itching to get out of Western Europe and into the weirdness of the post-soviet world. </p>
&nbsp;
<p> <strong> Fun Fact </strong> The official language of Germany is German, which Nick took for three nonconsecutive terms in order to wreck his GPA. </p>
 </section>

 <section id='klenova'>
   <h2>Klenova</h2>
   &nbsp;
<p> This tiny Czech hamlet is utterly uninteresting other than being the site of the Official Czech Out Launch Party. </p>
&nbsp;
<p> <strong> Projected Progress </strong> Cooper, Keshav, and Nick will relive their Geography FSP glory days by getting inappropriately drunk on a farm in the middle of nowhere. Shout out to Professor Mollett and Farm Party 2012!</p>
&nbsp;
<p> <strong> Fun Fact </strong> Despite its global reputation, Klenova is often confused for a big field. Even by people who have lived there for generations. </p>
 </section>

 <section id='prague'>
   <h2>Prague</h2>
   &nbsp;
<p> Prague is well known for being The Greatest City In The World, but it in fact has problems like any other. For instance, sometimes a half-liter of delicious beer will run you as much as $1.50 in the city center, as opposed to the usual $1. Also the sunset over Charles Bridge is occasionally obscured by clouds and thus only sort of spectacular. Oh yeah, and the faceless baby sculptures can be utterly terrifying. </p>
&nbsp;
<p> <strong> Projected Progress </strong> For three out of four RubikhanArtists, this is where it all began. We discovered our love for adventure and for each other as we spent ten weeks exploring the narrow corridors, weird art, and funny Czech dive bars of the city’s hidden corners. </p>
&nbsp;
<p> <strong> Fun Fact </strong> The Czech Republic has the strongest economy AND the most equine statues in Central Europe.  </p>
 </section>

<section id='vienna'>
   <h2>Vienna</h2>
&nbsp;
<p> Vienna is the capital and largest city of Austria. It is a nexus of culture, the arts, and food that is way too expensive. Vienna is known as the “City of Music,” having been home to famous composers like Mozart, Haydn, Beethoven, and Bonzo the Guitar Playing Chimpanzee (citation needed). </p>
&nbsp;
<p> <strong> Projected Progress </strong> Benjie hopes that his standard uniform of a dirt covered t-shirt, ripped shorts, and Toms (along with his seldom used royal title) will be sufficient to secure an invite to one of the renowned Viennese Balls. </p>
&nbsp;
<p> <strong> Fun Fact </strong> Austria is the second cousin, once removed of Australia, another well-known country.  </p>
 </section>

<section id='zagreb'>
   <h2>Zagreb</h2>
   &nbsp;
<p> Zagreb is similar to Vienna because it is the capital and largest city of its own country. However, this time the country is Croatia. In fact, Zagreb looks remarkably similar to the other Central-European capitals on the route (Prague and Vienna). Red roofs and church spires define a cityscape better suited for a Disney fairytale than for four grimy 22 year olds. </p>
&nbsp;
<p> <strong> Projected Progress </strong> The team will likely breeze through Zagreb en route to the stunning Croat coast—sure to be a relaxing highlight before d(r)iving into the less politically stable regimes of the next few thousand miles. </p>
&nbsp;
<p> <strong> Fun Fact </strong> Zabreb is least alphabetical capital in the world—narrowly beating out Armenia’s alphabetically challenged capital, Yerevan.  </p>
 </section>

 <section id='split'>
   <h2>Split</h2>
&nbsp;
<p> Split is a coastal city in the Croatian region of Dalmatia. The city has an impeccable climate and is a popular summer tourist destination due to its location on the pristine Adriatic Sea. </p>
&nbsp;
<p> <strong> Projected Progress </strong> The team will be sure to take an afternoon unwinding on the beach and exploring the nightlife, er sites, before heading down to equally idyllic Dubrovnik. </p>
&nbsp;
<p> <strong> Fun Fact </strong> Locals have given Split the nickname “The Most Beautiful City in the World.” This is likely because they have never been to White River Junction.  </p>

 <section id='dubrovnik'>
   <h2>Dubrovnik</h2>
&nbsp;
<p> The “Pearl of the Adriatic” is actually not the inside of an oyster but rather a small city! Dubrovnik is another sunny tourist town and a UNESCO World Heritage Site. </p>
&nbsp;
<p> <strong> Projected Progress </strong> While everyone will surely want to stay here forever, the open road calls us east and away from the safety net of touristed Europe.</p>
&nbsp;
<p> <strong> Fun Fact </strong> Dubrovnik has bedbugs. Good thing our team won’t be sleeping in beds! </p>
 </section>

 <section id='sofia'>
   <h2>Sofia</h2>
&nbsp;
<p> Continuing the capital and biggest city theme, Sofia fills that role for Bulgaria. The city has a distinct mix of medieval European and Communist-style architecture—with hints of Turkish influence from the East. Sofia is apparently horrible to drive in, with disorganized traffic and almost no parking. </p>
&nbsp;
<p> <strong> Projected Progress </strong> The team may not want to spend too much time here, as parking headaches are not exactly what we pictured when we imagined this ramshackle road trip across Eurasia.</p>
&nbsp;
<p> <strong> Fun Fact </strong> Sofia is one of only a couple of European capitals with a ski resort just nearby. It will not be open in July. </p>
 </section>

 <section id='istanbul'>
   <h2>Istanbul</h2>
&nbsp;
<p> Istanbul is the third largest city in the world and, with the possible exception of London, the absolute biggest urban area we’ll encounter on our journey. Straddling the Bosphorus waterway, Istanbul lies on the border of Europe and Asia. The street food and mosques are not to be missed—and for us, neither are the auto mechanics. </p>
&nbsp;
<p> <strong> Projected Progress </strong> Istanbul will be an important point of recalibration for Crossing the Rubikhan, as we’ll take a few days to fix any dings to our car and see the sites in this sprawling intersection of cultures and continents.</p>
&nbsp;
<p> <strong> Fun Fact </strong> They Might be Giants said it best: “Istanbul not Constantinople.” </p>
 </section>

 <section id='ankara'>
   <h2>Ankara</h2>
   &nbsp;
<p> Ankara is the capital of Turkey, located in the middle of the Anatolian plateau. The city is absolutely ancient, with archeological sites from at least seven different civilizations. </p>
&nbsp;
<p> <strong> Projected Progress </strong> Ankara is a bit of a detour, but will provide a much needed break from the raw heat of Turkey’s northern coastline and our minimally air-conditioned vehicle.</p>
&nbsp;
<p> <strong> Fun Fact </strong> Ankara has always been called Ankara, thus forfeiting any chance of having a They Might be Giants song named after them. </p>
 </section>
 
  <section id='batumi'>
    <h2>Batumi</h2>
    <p>This is our final stop on English-speaking soil. For the next 9,900 miles, we'll have to rely on our quick wits and charading skills to communiciate.</p>
  </section>
  <section id='tbilisi'>
    <h2>Tbilisi</h2>
    <p>One country down, twenty to go. At least we're driving on the right side of the road again. Provided Benjie doesn't run off with a fair French dame, we'll zip through France on our way east.</p>
  </section>
  <section id='baku'>
    <h2>Baku</h2>
    <p>A brief detour into Flanders will allow Cooper to induldge his love for Trappist beers. Hopefully, our resident Francophile, Benjie, won't pick any fights with the resident Flems.</p>
  </section>
  
 <section id='turkmenbashi'>
   <h2>Turkmenbashi</h2>
   <p>Population: 75,000</p>
<p> Welcome to Turkmenistan! The weirdest country this side of North Korea. Turkmenbashi was previously called Krasnovodsk until Turkmenistan’s President for Life, Saparmurat Niyazov renamed himself “Turkmenbashi,” meaning “Leader of all Turkmen” and named this city, along with several others and the month of January after himself. </p>
<p> <strong> Our Progress </strong> Depending on our luck, we may be in and out of Turkmenbashi and cruising down to Ashgabat in no time. OR we could be delayed offshore for three days, held up at the border due to the extremely narrow windows (five days) for Turkmen visas, and find ourselves having to memorize President Niyazov’s autobiography to gain ingress.     </p>
<p> <strong> Fun Fact </strong> Flights within Turkmenistan are heavily subsidized by their government—a ticket from Turkmenbashi to Ashgabat would cost roughly $14. But is it worth it?
 </section>

  <section id='ashgabat'>
   <h2>Ashgabat</h2>
   &nbsp;
<p> Turkmenistan’s national cult of crazy is naturally strongest in the capital. A 50 ft. golden statue of the dear President stands in the city center—and rotates to always face the sun. Other highlights include the world’s fourth tallest free standing flagpole, the Museum of Turkmen National Values and of course, the Turkmen Carpet Museum. </p>
&nbsp;
<p><strong>Our Progress:</strong> Keshav’s love of flagpoles has made Ashgabat a must-see destination of his since he was a boy, and the rest of Team Crossing the Rubikhan will be happy to oblige. However, the narrow window of our visas will keep the pressure on us to jump over to Uzbekistan as quickly as possible. </p>
&nbsp;
<p> <strong> Fun Fact </strong> Can you guess where the three tallest flag poles are located? Neither can we.
 </section>

</article>

<script>
var geojson = [
  { "geometry": { "type": "Point", "coordinates": [52.96187505907603, 57.392578125] },
    "properties": { "id": "cover", "zoom": 3 } },
  { "geometry": { "type": "Point", "coordinates": [-0.155697, 51.508726] },
    "properties": { "id": "hyde", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [1.310024, 51.128768] },
    "properties": { "id": "dover", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [1.876686, 50.96529] },
    "properties": { "id": "calais", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [3.73038, 51.053468] },
    "properties": { "id": "ghent", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [11.07675, 49.45403] },
    "properties": { "id": "nuremberg", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [13.22932, 49.332162] },
    "properties": { "id": "klenova", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [14.426765, 50.090679] },
    "properties": { "id": "prague", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [16.373819, 48.208174] },
    "properties": { "id": "vienna", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [15.976868, 45.81407] },
    "properties": { "id": "zagreb",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [16.440193, 43.514132] },
    "properties": { "id": "split",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [18.111048, 42.642889] },
    "properties": { "id": "dubrovnik",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [23.3230598, 42.6977149] },
    "properties": { "id": "sofia", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [28.9651646, 41.0096334] },
    "properties": { "id": "istanbul",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [32.8520491, 39.9272237] },
    "properties": { "id": "ankara",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [34.8296234, 38.642089] },
    "properties": { "id": "goreme",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [41.6360085, 41.6509502] },
    "properties": { "id": "batumi", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [44.8015706, 1.6935009] },
    "properties": { "id": "tbilisi",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [49.8466787, 40.3925137] },
    "properties": { "id": "baku",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [52.992897, 40.001903] },
    "properties": { "id": "turkmenbashi",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [58.3874263, 37.9396678] },
    "properties": { "id": "ashgabat", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [60.3620006, 41.3776893] },
    "properties": { "id": "khiva",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [64.4231326, 39.7675529] },
    "properties": { "id": "bukhara",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [66.9607742126004, 39.6415721] },
    "properties": { "id": "samarkand",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [68.7801624, 38.5346847] },
    "properties": { "id": "dushanbe", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [71.5493551, 37.4903983] },
    "properties": { "id": "khorog",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [73.3354022073445, 40.1538965] },
    "properties": { "id": "osh",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [74.6070383, 42.8767228] },
    "properties": { "id": "biskhek",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [76.9453467, 43.2389912] },
    "properties": { "id": "almaty", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [80.221526, 50.3484797] },
    "properties": { "id": "semey",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [82.9234476, 55.0282215] },
    "properties": { "id": "novosibirsk",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [92.8285269143647, 46.9828535] },
    "properties": { "id": "khovd",  "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [99.7467005557981, 45.143902] },
    "properties": { "id": "bayankhongor", "zoom": 10 } },

  { "geometry": { "type": "Point", "coordinates": [106.975911816806, 47.9462225] },
    "properties": { "id": "ulaanbaatar",  "zoom": 10 } },

];


var tiles = mapbox.layer().tilejson({
  tiles: [ "https://a.tiles.mapbox.com/v3/crossingtherubikhan.hf648fpg/{z}/{x}/{y}.png" ]
});

// Use https for markers
mapbox.markers.marker_baseurl = 'https://a.tiles.mapbox.com/v3/marker/';

var spots = mapbox.markers.layer()
  // Load up markers from geojson data.
  .features(geojson)
  // Define a new factory function. Takes geojson input and returns a
  // DOM element that represents the point.
  .factory(function(f) {
    var el = document.createElement('div');
    el.className = 'spot spot-' + f.properties.id;
    return el;
  });

// Creates the map with tile and marker layers and
// no input handlers (mouse drag, scrollwheel, etc).
var map = mapbox.map('map', [tiles, spots], null, []);

// Array of story section elements.
var sections = document.getElementsByTagName('section');

// Array of marker elements with order matching section elements.
var markers = _(sections).map(function(section) {
  return _(spots.markers()).find(function(m) {
    return m.data.properties.id === section.id;
  });
});

// Helper to set the active section.
var setActive = function(index, ease) {
  // Set active class on sections, markers.
  _(sections).each(function(s) { s.className = s.className.replace(' active', '') });
  _(markers).each(function(m) { m.element.className = m.element.className.replace(' active', '') });
  sections[index].className += ' active';
  markers[index].element.className += ' active';

  // Set a body class for the active section.
  document.body.className = 'section-' + index;

  // Ease map to active marker.
  if (!ease) {
    map.centerzoom(markers[index].location, markers[index].data.properties.zoom||14)
    .zoom(6);
  } else {
    map.ease.location(markers[index].location).zoom(markers[index].data.properties.zoom||14).optimal(0.75, 1.00);
  }

  return true;
};

// Bind to scroll events to find the active section.
window.onscroll = _(function() {
  // IE 8
  if (window.pageYOffset === undefined) {
    var y = document.documentElement.scrollTop;
    var h = document.documentElement.clientHeight;
  } else {
    var y = window.pageYOffset;
    var h = window.innerHeight;
  }

  // If scrolled to the very top of the page set the first section active.
  if (y === 0) return setActive(0, true);

  // Otherwise, conditionally determine the extent to which page must be
  // scrolled for each section. The first section that matches the current
  // scroll position wins and exits the loop early.
  var memo = 0;
  var buffer = (h * 0.3333);
  var active = _(sections).any(function(el, index) {
    memo += el.offsetHeight;
    return y < (memo-buffer) ? setActive(index, true) : false;
  });

  // If no section was set active the user has scrolled past the last section.
  // Set the last section active.
  if (!active) setActive(sections.length - 1, true);
}).debounce(10);

// Set map to first section.
setActive(0, false);
</script>

</body>
</html>
